{% extends "base.html" %} {% block title %}Список клієнтів{% endblock %} {% block content %}
<h1>Створити переміщення</h1>
<form method="post" action="{% url 'create_transportation' %}" class="row" id="composition-form">
  {% csrf_token %}
  <div class="col-3">
    <label for="" class="form-label">Відправник</label>
    <select id="sender" name="sender" style="width: 300px" class="form-select">
      {% if transportation.sender_id %}
      <option value="{{ transportation.sender.id }}" selected>{{ transportation.sender.name }}</option>
      {% endif %}
    </select>
  </div>
  <div class="col-3">
    <label for="" class="form-label">Отримувач</label>
    <select id="receiver" name="receiver" style="width: 300px" class="form-select">
      {% if transportation.receiver_id %}
      <option value="{{ transportation.receiver.id }}" selected>{{ transportation.receiver.name }}</option>
      {% endif %}
    </select>
  </div>
  <button type="submit">Додати</button>
</form>

<h2>Пошук по номеру переміщення</h2>
<form method="get" class="d-flex mb-3">
  <input type="text" name="search_tel" class="form-control me-2" placeholder="Введіть номер переміщення" value="{{ request.GET.search_transportation }}" />
  <button type="submit" class="btn btn-primary">Знайти</button>
  <a href="/" class="btn btn-secondary ms-2">Скинути</a>
</form>
<h1>Список переміщень</h1>
<table border="1" class="table table-striped">
  <tr>
    <th cope="col">ID</th>
    <th cope="col">Дата</th>
    <th cope="col">Склад відправки</th>
    <th cope="col">Склад отримувача</th>
    <th cope="col">Статус</th>
    <th cope="col">Дія</th>
  </tr>
  {% for transportation in transportations %}
  <tr>
    <td>{{ transportation.id }}</td>
    <td>{{ transportation.date }}</td>
    <td>{{ transportation.sender.name }}</td>
    <td>{{ transportation.receiver.name }}</td>
    <td>{{ transportation.get_status_display }}</td>
    <td scope="row">
      <div class="d-flex">
        <form method="post" action="{% url 'transportation' transportation.id %}">
          {% csrf_token %}
          <button type="submit" class="btn btn-danger btn-sm me-2">Переглянути</button>
        </form>
      </div>
    </td>
  </tr>
  {% empty %}
  <tr>
    <td colspan="6">Переміщень не знайдено</td>
  </tr>
  {% endfor %}
</table>

<script>
  function initSelect2(id) {
    $(id).select2({
      placeholder: "Назва складу",
      minimumInputLength: 1,
      ajax: {
        url: '{% url "compositions_autocomplete" %}',
        dataType: "json",
        delay: 250,
        data: function (params) {
          return { q: params.term };
        },
        processResults: function (data) {
          return {
            results: data.map(function (composition) {
              return { id: composition.id, text: composition.name };
            }),
          };
        },
        cache: true,
      },
    });
  }

  $(document).ready(function () {
    initSelect2("#sender");
    initSelect2("#receiver");
  });
</script>

{% endblock %}
